---
phase: 03-integration-testing-deploy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/PasswordGate.tsx
  - src/contexts/AdminContext.tsx
  - src/pages/Admin.tsx
  - public/robots.txt
autonomous: true
requirements:
  - AUTH-04
  - AUTH-01
must_haves:
  truths:
    - "Admin auth uses sessionStorage only — closing the tab forgets the session"
    - "No localStorage references remain in any admin auth code path"
    - "/admin is disallowed in robots.txt for all crawlers"
    - "No orphaned Admin.tsx page exists to confuse future development"
  artifacts:
    - path: "src/components/admin/PasswordGate.tsx"
      provides: "Password gate with sessionStorage-only auth"
      contains: "sessionStorage.setItem"
    - path: "src/contexts/AdminContext.tsx"
      provides: "Admin context with sessionStorage-only rehydration"
      contains: "sessionStorage.getItem('admin_auth')"
    - path: "public/robots.txt"
      provides: "Search engine exclusion for /admin"
      contains: "Disallow: /admin"
  key_links:
    - from: "src/components/admin/PasswordGate.tsx"
      to: "src/contexts/AdminContext.tsx"
      via: "sessionStorage 'admin_auth' key"
      pattern: "sessionStorage\\.(get|set)Item\\('admin_auth'"
---

<objective>
Fix pre-deploy code issues required by CONTEXT.md decisions before any testing begins.

Purpose: Align the codebase with locked decisions (sessionStorage-only auth, /admin excluded from search engines) and remove dead code (orphaned Admin.tsx page).

Output: Clean admin auth flow using sessionStorage only, robots.txt updated, orphaned page removed.
</objective>

<execution_context>
@/Users/zachconnermba/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zachconnermba/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration-testing-deploy/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove localStorage from admin auth — sessionStorage only</name>
  <files>
    src/components/admin/PasswordGate.tsx
    src/contexts/AdminContext.tsx
    src/pages/Admin.tsx
  </files>
  <action>
**PasswordGate.tsx:**
1. Remove the `remember` state: delete `const [remember, setRemember] = useState(false);`
2. Remove the Remember Me checkbox label+input (lines 60-68)
3. In `handleSubmit`, remove the `if (remember)` branch — always use `sessionStorage.setItem('admin_auth', password)` directly. The resulting submit handler:
```typescript
try {
  await fetchUsage(password);
  sessionStorage.setItem('admin_auth', password);
  onAuth(password);
} catch {
  setError('Incorrect password');
} finally {
  setLoading(false);
}
```

**AdminContext.tsx:**
1. Line 60: Change `const stored = localStorage.getItem('admin_auth') || sessionStorage.getItem('admin_auth');` to `const stored = sessionStorage.getItem('admin_auth');`
2. Line 113 in `signOut`: Remove `localStorage.removeItem('admin_auth');` — keep only `sessionStorage.removeItem('admin_auth');`

**Admin.tsx (delete file):**
Delete `src/pages/Admin.tsx` entirely. It is an orphaned page (not routed in App.tsx), contains localStorage references that violate the sessionStorage-only decision, and creates confusion. The floating overlay approach via AdminActivator + AdminOverlay is the production architecture.

After deletion, verify `Admin.tsx` is not imported anywhere:
```bash
grep -r "Admin.tsx\|from.*pages/Admin\|pages/Admin" src/ --include="*.tsx" --include="*.ts"
```
If any imports found, remove them.
  </action>
  <verify>
1. `grep -r "localStorage" src/components/admin/PasswordGate.tsx src/contexts/AdminContext.tsx` returns no results
2. `grep -r "remember" src/components/admin/PasswordGate.tsx` returns no results
3. `ls src/pages/Admin.tsx` returns "No such file"
4. `npx tsc --noEmit` passes with no errors
5. `npm run build` succeeds
  </verify>
  <done>
All admin auth code uses sessionStorage exclusively. No localStorage references in PasswordGate.tsx or AdminContext.tsx. Admin.tsx orphaned page is deleted. TypeScript compiles clean. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add /admin to robots.txt Disallow and verify SEO exclusion</name>
  <files>public/robots.txt</files>
  <action>
Add `Disallow: /admin` to the default User-agent section in `public/robots.txt`.

Insert after the existing `Disallow: /guides/` line under `User-agent: *`:
```
Disallow: /admin
```

The resulting block should read:
```
User-agent: *
Allow: /
Disallow: /thanks
Disallow: /thank-you-for-your-submission
Disallow: /guides/
Disallow: /admin
```

No changes needed for specific bot user-agent sections (Googlebot, GPTBot, etc.) — the default `User-agent: *` Disallow is sufficient because the specific bot sections only have `Allow: /` which doesn't override per-path Disallow rules for `/admin`.
  </action>
  <verify>
1. `grep "Disallow: /admin" public/robots.txt` returns the line
2. `npm run build` succeeds (robots.txt copied to dist/)
3. `ls dist/robots.txt` confirms file exists in build output
  </verify>
  <done>
robots.txt contains `Disallow: /admin` under the default User-agent block. Search engines will not index the admin panel route.
  </done>
</task>

</tasks>

<verification>
1. No `localStorage` references in any admin-related files:
   `grep -r "localStorage" src/components/admin/ src/contexts/AdminContext.tsx src/pages/Admin.tsx 2>/dev/null`
2. TypeScript clean: `npx tsc --noEmit`
3. Build succeeds: `npm run build`
4. robots.txt updated: `grep "Disallow: /admin" public/robots.txt`
5. Admin.tsx deleted: `test ! -f src/pages/Admin.tsx && echo "PASS" || echo "FAIL"`
</verification>

<success_criteria>
- Zero localStorage references in admin auth code paths
- sessionStorage is the sole persistence mechanism for admin_auth
- robots.txt blocks /admin from all search crawlers
- Admin.tsx orphaned page no longer exists
- Build compiles clean with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-testing-deploy/03-01-SUMMARY.md`
</output>
